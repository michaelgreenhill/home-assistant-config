- id: update_morning_commute_sensor
  alias: Commute - Update morning commute sensor
  initial_state: 'on'
  trigger:
  - platform: time_pattern
    minutes: /2
  condition:
  - condition: time
    after: 06:00:00
    before: 07:00:00
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  action:
  - service: homeassistant.update_entity
    entity_id: sensor.phone_to_work
- id: '1611365161122'
  alias: Kitchen - Arrival at night - ON
  description: 'Turns on the entry lights when arriving home after dark. '
  trigger:
  - platform: state
    entity_id: group.people
    to: home
  condition:
  - condition: time
    after: '18:00:00'
    before: 06:00:00
  action:
  - service: light.turn_on
    data: {}
    entity_id: light.kitchen_2
  - service: hue.hue_activate_scene
    data:
      group_name: Kitchen
      scene_name: Warm
  initial_state: 'on'
  mode: single
- id: '1611368002076'
  alias: Living Room - Cool on arrival
  description: If it's hot inside, turn on the AC when we arrive home.
  trigger:
  - platform: state
    entity_id: group.people
    from: not_home
    to: home
  condition:
  - condition: numeric_state
    entity_id: sensor.living_room_temp
    above: '28'
  action:
  - service: climate.set_fan_mode
    data:
      fan_mode: auto
    target:
      device_id: 0bf6da44f50702f1611f23242aac6d10
  - service: climate.set_temperature
    data:
      temperature: 22
      hvac_mode: cool
  - service: climate.turn_on
    data: {}
    target:
      device_id: 0bf6da44f50702f1611f23242aac6d10
  initial_state: 'on'
  mode: single
- id: '1614987008873'
  alias: Living Room - Sound System - ON
  description: 'Automatically turns on the sound system when the TV is turned on. '
  trigger:
  - platform: state
    entity_id: switch.living_room_tv
    from: 'off'
    to: 'on'
  condition: []
  action:
  - type: turn_on
    device_id: 855e34d2e92c4228b9f5f6f01dc0e485
    entity_id: switch.shed
    domain: switch
  mode: single
- id: '1614987092745'
  alias: Living Room - Sound System - OFF
  description: Automatically turns off the sound system when the TV is turned off.
  trigger:
  - platform: state
    entity_id: switch.living_room_tv
    from: 'on'
    to: 'off'
  condition: []
  action:
  - type: turn_off
    device_id: 855e34d2e92c4228b9f5f6f01dc0e485
    entity_id: switch.shed
    domain: switch
  mode: single
- id: '1615184983830'
  alias: Doorbell chime
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.front_door_ding
    to: 'on'
  condition: []
  action:
  - service: media_player.play_media
    data:
      media_content_id: https://hassio.selby.michaelgreenhill.net/local/sound/promise-616.mp3
      media_content_type: audio/mp3
    target:
      device_id:
      - 6758e51a93be1590e503ed5460d022a7
      - 610b4c1201fbac054c670d2085b4f537
      - f8f169cb07ff67317268c1d22dd25d5b
  mode: single
- id: '1624249913765'
  alias: Pantry - Light Switch - TOGGLE
  description: 'Toggles the living room lights on/off state, scenes, and brightness
    via an Ikea Tradfri remote. '
  use_blueprint:
    path: frenck/zha-ikea-five-button-remote-for-lights.yaml
    input:
      remote: f71d85e1471099753e1afbfb91174120
      light:
        area_id:
        - pantry
      force_brightness: true
      brightness: 80
      button_left_short:
      - service: input_select.select_previous
        target:
          entity_id: input_select.cycle_hue_scenes
      button_left_long:
      - service: hue.hue_activate_scene
        data:
          group_name: Pantry
          scene_name: Bright
      button_right_long:
      - service: hue.hue_activate_scene
        data:
          group_name: Pantry
          scene_name: Relax
      button_right_short:
      - service: input_select.select_next
        target:
          entity_id: input_select.cycle_hue_scenes
- id: '1624268430987'
  alias: Pantry - Light Switch - Scene Cycler
  description: Cycles through Philips Hue scenes when triggered via Living Room -
    Light Switch
  trigger:
  - platform: state
    entity_id: input_select.cycle_hue_scenes
  action:
  - service: hue.hue_activate_scene
    data:
      group_name: Pantry
      scene_name: '{{ states(''input_select.cycle_hue_scenes'') }}'
  mode: single
- id: '1641095662786'
  alias: Front porch - Step lights - ON
  description: Turns on the step lights on the front porch when the motion- sensor
    starts.
  trigger:
  - platform: device
    type: turned_on
    device_id: 53feaf5ae4f781dc7525408576d760c8
    entity_id: light.front_porch_light_1
    domain: light
  condition: []
  action:
  - type: turn_on
    device_id: 5d823bf2909ad2bcfb0e7818ff81de9e
    entity_id: light.front_porch_uplights
    domain: light
  mode: single
- id: '1641095818893'
  alias: Front porch - Step lights - OFF
  description: Turns off the step lights on the front porch when the motion sensor
    ends.
  trigger:
  - platform: device
    type: turned_off
    device_id: 53feaf5ae4f781dc7525408576d760c8
    entity_id: light.front_porch_light_1
    domain: light
  condition: []
  action:
  - type: turn_off
    device_id: 5d823bf2909ad2bcfb0e7818ff81de9e
    entity_id: light.front_porch_uplights
    domain: light
  mode: single
- id: '1641099129998'
  alias: Notification - Front door low battery
  description: Sends a notification when the front door Yale Assure SL lock has low
    charge remaining.
  trigger:
  - type: battery_level
    platform: device
    device_id: 7e4bb806c485d30f69129236ba75303a
    entity_id: sensor.front_door_lock_8cfff910_power
    domain: sensor
    below: 25
  condition: []
  action:
  - service: notify.notify
    data:
      message: Front door has low battery
      title: Front door has low battery
  mode: single
- id: '1641278974877'
  alias: Front porch - Lock deadbolt at night
  description: Locks the front door deadbolt at 11 p.m.
  trigger:
  - platform: time
    at: '23:00:00'
  condition: []
  action:
  - device_id: 7e4bb806c485d30f69129236ba75303a
    domain: lock
    entity_id: lock.front_door_lock_8cfff910_door_lock
    type: lock
  mode: single
- id: '1641279172086'
  alias: Backyard - Festoon lights ON
  description: 'Turns on the second set of festoon lights when the first is turned
    on. '
  trigger:
  - platform: device
    type: turned_on
    device_id: f793b4c10303183589ce4bd9f9d9f606
    entity_id: light.backyard_festoon_lights_1
    domain: light
  condition: []
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.backyard_festoon_lights_2
  mode: single
- id: '1641279259917'
  alias: Backyard - Festoon lights OFF
  description: Turns off the second set of festoon lights when the first is turned
    off.
  trigger:
  - platform: device
    type: turned_off
    device_id: f793b4c10303183589ce4bd9f9d9f606
    entity_id: light.backyard_festoon_lights_1
    domain: light
  condition: []
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.backyard_festoon_lights_2
  mode: single
- id: '1643510261190'
  alias: Pantry lights - IKEA on/off switch
  description: ''
  use_blueprint:
    path: poolcactus/zha-ikea-tradfri-on-off-switch-incl-dimmer.yaml
    input:
      remote: 22f7dad4145ec0c2db9b0d48c8696e5a
      light:
        area_id: pantry
- id: '1643775945998'
  alias: Pantry Lights - ON
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: c5869592d84c6d3fe3c0daa33889b751
    entity_id: binary_sensor.lumi_lumi_sensor_magnet_aq2_on_off
    domain: binary_sensor
  condition: []
  action:
  - service: light.turn_on
    data:
      brightness_pct: 100
    target:
      area_id: pantry
  mode: single
- id: '1643775998123'
  alias: Pantry lights - OFF
  description: ''
  trigger:
  - type: not_opened
    platform: device
    device_id: c5869592d84c6d3fe3c0daa33889b751
    entity_id: binary_sensor.lumi_lumi_sensor_magnet_aq2_on_off
    domain: binary_sensor
  condition: []
  action:
  - service: light.turn_off
    data: {}
    target:
      area_id: pantry
  mode: single
- id: '1644716482628'
  alias: Shed - IKEA wireless on/off switch
  description: ''
  use_blueprint:
    path: Xelloss99/zha-ikea-tradfri-on-off-switch.yaml
    input:
      remote: 22f7dad4145ec0c2db9b0d48c8696e5a
      button_on_short:
      - type: turn_on
        device_id: 3d82efb363d044ccb300cd8b66e59865
        entity_id: switch.freezer
        domain: switch
      button_off_short:
      - type: turn_off
        device_id: 3d82efb363d044ccb300cd8b66e59865
        entity_id: switch.freezer
        domain: switch
      button_on_long:
      - type: turn_on
        device_id: eaf5f4f00b4288a7b2add3d4ef45c924
        entity_id: switch.shed_floodlight
        domain: switch
      button_off_long:
      - type: turn_off
        device_id: eaf5f4f00b4288a7b2add3d4ef45c924
        entity_id: switch.shed_floodlight
        domain: switch
- id: '1649745770599'
  alias: Kitchen - Turn on dim lights at night with motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 41622ebcffbf84a3fb68b12e38e010cf
    entity_id: binary_sensor.lumi_lumi_sensor_motion_7b9b4305_ias_zone
    domain: binary_sensor
  condition:
  - condition: device
    type: is_off
    device_id: a8b64e55ded335ad42689a13a8a10a6b
    entity_id: light.kitchen_2
    domain: light
  - condition: time
    before: 05:00:00
    after: '23:00:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  - condition: device
    type: is_off
    device_id: 21f7fe7a58392131a46357cf7e6007ba
    entity_id: light.living_room
    domain: light
  action:
  - service: hue.hue_activate_scene
    data:
      scene_name: Nightlight
      group_name: Kitchen
  mode: single
- id: '1649746845705'
  alias: Kitchen - Turn off dim lights at night after motion ends
  description: ''
  trigger:
  - type: no_motion
    platform: device
    device_id: 41622ebcffbf84a3fb68b12e38e010cf
    entity_id: binary_sensor.lumi_lumi_sensor_motion_7b9b4305_ias_zone
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 5
  condition:
  - condition: device
    type: is_on
    device_id: a8b64e55ded335ad42689a13a8a10a6b
    entity_id: light.kitchen_2
    domain: light
  - condition: time
    before: 05:00:00
    after: '23:00:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  - condition: device
    type: is_off
    device_id: 21f7fe7a58392131a46357cf7e6007ba
    entity_id: light.living_room
    domain: light
  action:
  - type: turn_off
    device_id: a8b64e55ded335ad42689a13a8a10a6b
    entity_id: light.kitchen_2
    domain: light
  mode: single
- id: '1649763439408'
  alias: Morning heater for Freya
  description: ''
  trigger:
  - platform: time
    at: 05:00:00
  condition:
  - condition: numeric_state
    entity_id: climate.lounge_room_aircon
    attribute: current_temperature
    below: '16'
  - condition: or
    conditions:
    - condition: device
      device_id: 1c857eed5cb18f5a930c4bdc4db4c097
      domain: device_tracker
      entity_id: device_tracker.pixel_5
      type: is_home
    - condition: device
      device_id: d35d5f8712956e48439978c4719a024a
      domain: device_tracker
      entity_id: device_tracker.freya_s_sm_g960f
      type: is_home
    - condition: zone
      entity_id: person.michael
      zone: zone.home
  - condition: time
    before: 06:00:00
    after: 04:00:00
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  action:
  - service: climate.set_temperature
    data:
      hvac_mode: heat
      temperature: 18
    target:
      device_id: 0bf6da44f50702f1611f23242aac6d10
  - service: climate.turn_on
    data: {}
    target:
      device_id: 0bf6da44f50702f1611f23242aac6d10
  mode: single
- id: '1649765142678'
  alias: Living Room - Heat on arrival
  description: If it's coldd inside, turn on the AC when we arrive home.
  trigger:
  - platform: state
    entity_id: group.people
    from: not_home
    to: home
  condition:
  - condition: numeric_state
    entity_id: sensor.living_room_temp
    below: '16'
  - condition: numeric_state
    entity_id: sensor.front_porch_motion_sensor_temperature
    below: '16'
  action:
  - service: climate.set_fan_mode
    data:
      fan_mode: auto
    target:
      device_id: 0bf6da44f50702f1611f23242aac6d10
  - service: climate.set_temperature
    data:
      temperature: 18
      hvac_mode: heat
  - service: climate.turn_on
    data: {}
    target:
      device_id: 0bf6da44f50702f1611f23242aac6d10
  mode: single
  initial_state: 'on'
- id: '1649999891633'
  alias: Alarm - Indoor occupancy while away
  description: ''
  trigger:
  - type: occupied
    platform: device
    device_id: 41622ebcffbf84a3fb68b12e38e010cf
    entity_id: binary_sensor.lumi_lumi_sensor_motion_7b9b4305_occupancy
    domain: binary_sensor
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: group.people
      for:
        hours: 0
        minutes: 0
        seconds: 0
      state: home
  action:
  - service: notify.amazon_ses
    data:
      message: ALARM - Indoor occupancy detected
      title: ALARM - Indoor occupancy detected
      target: doctorjbeam@gmail.com
  - service: notify.mobile_app_pixel_5
    data:
      message: ALARM - Indoor occupancy detected
      title: ALARM - Indoor occupancy detected
  mode: single
- id: '1650000125739'
  alias: Kitchen - Turn on dim lights at night with motion 5am
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: 41622ebcffbf84a3fb68b12e38e010cf
    entity_id: binary_sensor.lumi_lumi_sensor_motion_7b9b4305_ias_zone
    domain: binary_sensor
  condition:
  - condition: device
    type: is_off
    device_id: a8b64e55ded335ad42689a13a8a10a6b
    entity_id: light.kitchen_2
    domain: light
  - condition: time
    before: 06:00:00
    after: 05:00:00
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  action:
  - service: hue.hue_activate_scene
    data:
      scene_name: Relax
      group_name: Kitchen
  mode: single
- id: '1650605718204'
  alias: Laundry - Turn on dim lights at night with motion
  description: ''
  trigger:
  - type: motion
    platform: device
    device_id: adf55e9c67a1d24e1381a322bd5cb035
    entity_id: binary_sensor.lumi_lumi_sensor_motion_ias_zone
    domain: binary_sensor
  condition:
  - condition: time
    before: 05:00:00
    after: '23:00:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  - condition: device
    type: is_off
    device_id: dd9925129896c0ef1b24d2c784344190
    entity_id: light.laundry
    domain: light
  - condition: device
    type: is_off
    device_id: 21f7fe7a58392131a46357cf7e6007ba
    entity_id: light.living_room
    domain: light
  action:
  - service: hue.hue_activate_scene
    data:
      scene_name: Nightlight
      group_name: Laundry
  mode: single
- id: '1650605849825'
  alias: Laundry - Turn off dim lights at night after motion ends
  description: ''
  trigger:
  - type: no_motion
    platform: device
    device_id: adf55e9c67a1d24e1381a322bd5cb035
    entity_id: binary_sensor.lumi_lumi_sensor_motion_ias_zone
    domain: binary_sensor
  condition:
  - condition: time
    before: 05:00:00
    after: '23:00:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    - sat
    - sun
  - condition: device
    type: is_on
    device_id: dd9925129896c0ef1b24d2c784344190
    entity_id: light.laundry
    domain: light
  action:
  - type: turn_off
    device_id: dd9925129896c0ef1b24d2c784344190
    entity_id: light.laundry
    domain: light
    metadata:
      secondary: false
  mode: single
- id: '1650606704037'
  alias: Alarm - Workshop occupancy while away
  description: ''
  trigger:
  - type: occupied
    platform: device
    device_id: 2a9a65b91131d7ec0087ea2570483c01
    entity_id: binary_sensor.lumi_lumi_sensor_motion_dbcc2205_occupancy
    domain: binary_sensor
  condition:
  - condition: not
    conditions:
    - condition: state
      entity_id: group.people
      for:
        hours: 0
        minutes: 0
        seconds: 0
      state: home
  action:
  - service: notify.amazon_ses
    data:
      message: ALARM - Indoor occupancy detected
      title: ALARM - Indoor occupancy detected
      target: doctorjbeam@gmail.com
  - service: notify.mobile_app_pixel_5
    data:
      message: ALARM - Indoor occupancy detected
      title: ALARM - Indoor occupancy detected
  mode: single
- id: wunderground_data_upload
  alias: WUnderground data upload
  use_blueprint:
    path: dvandonkelaar/wunderground_upload.yaml
    input:
      station_id: !secret wunderground_station_id
      station_key: !secret wunderground_station_key
      #sensor_baro: 'sensor.outdoor_pressure'
      sensor_temp: 'sensor.frontdoor_temperature'
      sensor_humidity: 'sensor.frontdoor_humidity'
      #sensor_rain: >-
      #  {{ states('sensor.backyard_rainfall_meter_rt') | float - states('sensor.selby_rainfall_1_hour_ago_2') | float }}
      sensor_dailyrain: 'sensor.selby_rainfall_daily'
      sensor_winddir: 'sensor.backyard_anemometer_wind_direction_corrected'
      sensor_windspeed: 'sensor.backyard_anemometer_average_wind_speed'
      sensor_windgust: 'sensor.backyard_anemometer_max_wind_speed'
      refresh_frequency: 60
      trigger_entities:
        - sensor.frontdoor_temperature
        - sensor.frontdoor_humidity
        - sensor.backyard_rainfall_meter_rt
        - sensor.selby_rainfall_daily
        - sensor.backyard_anemometer_wind_direction_corrected
        - sensor.backyard_anemometer_average_wind_speed
        - sensor.backyard_anemometer_max_wind_speed
        - sensor.selby_rainfall_1_hour_ago_2
      curl_command_service: shell_command.curl_get
- id: 'linen_cupboard_on'
  alias: Linen cupboard lights - ON
  description: ''
  trigger:
  - type: opened
    platform: device
    device_id: 2885b681ad2ff4ce852c5f5c719c46b4
    entity_id: binary_sensor.lumi_lumi_sensor_magnet_aq2_870fed07_on_off
    domain: binary_sensor
  condition: []
  action:
  - service: scene.turn_on
    target:
      entity_id: scene.hallway_bright
    metadata: {}
  mode: single
- id: 'linen_cupboard_off'
  alias: Linen cupboard lights - OFF
  description: ''
  trigger:
  - type: not_opened
    platform: device
    device_id: 2885b681ad2ff4ce852c5f5c719c46b4
    entity_id: binary_sensor.lumi_lumi_sensor_magnet_aq2_870fed07_on_off
    domain: binary_sensor
  condition: []
  action:
  - service: light.turn_off
    data: {}
    target:
      area_id: hallway
  mode: single

- id: 'front_porch_lux_motion_on'
  alias: 'Front porch - ON'
  description: 'Turns on the front porch lights when motion is detected and the lux level is below 100.'
  trigger:
  - type: motion
    platform: device
    device_id: 8a96625513cf9701ec3cfd7da08bda36
    entity_id: binary_sensor.front_porch_motion_sensor_motion
    domain: binary_sensor
  condition:
  - type: is_illuminance
    condition: device
    device_id: 8a96625513cf9701ec3cfd7da08bda36
    entity_id: sensor.front_porch_motion_sensor_illuminance
    domain: sensor
    below: 100
  action: 
  - type: turn_on
    device_id: 53feaf5ae4f781dc7525408576d760c8
    entity_id: light.front_porch_light_1
    domain: light
  - type: turn_on
    device_id: f9cc45d2f473af2b300604f4baa56202
    entity_id: light.front_porch_light_2
    domain: light
  - type: turn_on
    device_id: 5d823bf2909ad2bcfb0e7818ff81de9e
    entity_id: light.front_porch_uplights
    domain: light
  - type: turn_on
    device_id: d6b921956b57498c0946463bb7c3071b
    entity_id: light.porch
    domain: light

- id: 'front_porch_lux_motion_off'
  alias: 'Front porch - OFF'
  description: 'Turns off the front porch lights after motion ends and the lux level is below 100.'
  trigger:
  - type: no_motion
    platform: device
    device_id: 8a96625513cf9701ec3cfd7da08bda36
    entity_id: binary_sensor.front_porch_motion_sensor_motion
    domain: binary_sensor
  condition:
  - type: is_illuminance
    condition: device
    device_id: 8a96625513cf9701ec3cfd7da08bda36
    entity_id: sensor.front_porch_motion_sensor_illuminance
    domain: sensor
    below: 100
  action: 
  - type: turn_off
    device_id: 53feaf5ae4f781dc7525408576d760c8
    entity_id: light.front_porch_light_1
    domain: light
  - type: turn_off
    device_id: f9cc45d2f473af2b300604f4baa56202
    entity_id: light.front_porch_light_2
    domain: light
  - type: turn_off
    device_id: 5d823bf2909ad2bcfb0e7818ff81de9e
    entity_id: light.front_porch_uplights
    domain: light
  - type: turn_off
    device_id: d6b921956b57498c0946463bb7c3071b
    entity_id: light.porch
    domain: light
